@model ShowRangListOptionsVM

<form asp-area="User" asp-controller="RangList" asp-action="FilterRangList" method="post" id="rang-list-form">
    <div class="text-center w-100">
        <section style="width: 100%; margin: 0; padding: 0; margin-top: -3rem">
            <div style=" width: 100%; 
                height: 450px; 
                background: linear-gradient(rgba(0, 51, 102, 0.85), rgba(0, 51, 102, 0.85)),
                url('/Images/rang list/rang.jpg') center/cover no-repeat; 
                display: flex; 
                flex-direction: column; 
                justify-content: center; 
                align-items: center; 
                text-align: center; 
                color: white;">
                <h1 style="font-size: 4rem; font-weight: bold;">Ранг Листа</h1>
                <p style="font-size: 1.5rem; margin-bottom: 0;">
                    Погледнете ги најдобрите учесници и нивните постигнувања по настани и категории.
                </p>
            </div>
        </section>

        <section class="gradient-dark-section">
            <div style="max-width: 1400px; margin: 0 auto; position: relative; z-index: 2;">
                <div style="color: white; margin-bottom: 2rem;">
                    <h2 style="font-weight: bold; text-align: center; margin-bottom: 1.5rem;">
                        Резултати од натпреварите
                    </h2>
                    <p style="text-align: left; max-width: 800px; margin: 0 auto 2.5rem;">
                        Погледнете ги резултатите од натпреварите што се одржаа во одредениот период од квизовите во различни области. Изберете настан, категорија и година за да го пронајдете рангирањето што ве интересира.
                    </p>
                </div>

                <div style="display: flex; flex-wrap: wrap; gap: 1.5rem; justify-content: center; margin-bottom: 2rem;">
                    <div style="flex: 1 1 300px; max-width: 300px;">
                        <label class="p-0 text-white">Селектирај Настан</label>
                        <select asp-for="SelectedEventId" asp-items="@Model.Events" class="form-select w-100">
                            <option selected value="">--Селектирај Настан--</option>
                        </select>
                        <span asp-validation-for="SelectedEventId" class="text-danger"></span>
                    </div>

                    <div style="flex: 1 1 300px; max-width: 300px;">
                        <label class="p-0 text-white">Селектирај Категорија</label>
                        <select asp-for="SelectedCategoryId" asp-items="@Model.Categories" class="form-select w-100">
                            <option selected value="">--Селектирај Категорија--</option>
                        </select>
                        <span asp-validation-for="SelectedCategoryId" class="text-danger"></span>
                    </div>

                    <div style="flex: 1 1 300px; max-width: 300px;">
                        <label class="p-0 text-white">Селектирај Година</label>
                        <select asp-for="SelectedYear" asp-items="@Model.EventsByYear" class="form-select w-100">
                            <option selected value="">--Селектирај Година--</option>
                        </select>
                        <span asp-validation-for="SelectedYear" class="text-danger"></span>
                    </div>
                </div>

                <div style="text-align: center; margin-top: 2rem;">
                    <button type="submit" class="btn" style="padding: 1rem 3rem; font-size: 1.2rem; background-color: transparent; color: white; border: 2px solid white; transition: all 0.3s ease;">
                        Пребарај
                    </button>
                </div>
            </div>

            <style>
                .gradient-dark-section {
                    position: relative;
                    width: 100%;
                    background-color: #2b3035;
                    padding: 2rem 3rem;
                    margin-top: 0;
                    overflow: hidden;
                }

                    .gradient-dark-section::before {
                        content: "";
                        position: absolute;
                        top: 0;
                        left: 0;
                        right: 0;
                        height: 20%;
                        background: radial-gradient(ellipse at top center, rgba(255, 255, 255, 0.15), transparent);
                        pointer-events: none;
                        z-index: 1;
                    }

                    .gradient-dark-section::after {
                        content: "";
                        position: absolute;
                        bottom: 0;
                        left: 0;
                        right: 0;
                        height: 20%;
                        background: radial-gradient(ellipse at bottom center, rgba(255, 255, 255, 0.15), transparent);
                        pointer-events: none;
                        z-index: 1;
                    }

                    .gradient-dark-section .line-top, .gradient-dark-section .line-bottom {
                        position: absolute;
                        left: 0;
                        right: 0;
                        height: 1.5px;
                        background: rgba(255, 255, 255, 0.2);
                        z-index: 3;
                    }

                    .gradient-dark-section .line-top {
                        top: 0;
                    }

                    .gradient-dark-section .line-bottom {
                        bottom: 0;
                    }

                button[type="submit"]:hover {
                    background-color: white !important;
                    color: #2b3035 !important;
                }
            </style>

            <div class="line-top"></div>
            <div class="line-bottom"></div>
        </section>
    </div>
</form>

<div id="table-container" style="max-width: 1400px; margin: 2rem auto;">
    <table class="table table-striped table-bordered w-100 text-center">
        <thead>
            <tr>
                <th>Место</th>
                <th>Име и Презиме</th>
                <th>Град</th>
                @if (Model?.ShowRangList is not null)
                {
                    @foreach (var category in Model?.ShowRangList?.CategoriesRangList ?? new())
                    {
                        <th>@category?.Category?.categoryName</th>
                    }
                }
                @if ((Model?.SelectedEventId != null && Model?.SelectedCategoryId == null) ||
                (Model?.SelectedCategoryId == null && Model?.SelectedYear != null) ||
                (Model?.SelectedCategoryId == null && Model?.SelectedEventId != null && Model?.SelectedYear != null))
                {
                    <th>Вкупно</th>
                }
            </tr>
        </thead>
        <tbody>
            @{
                int i = 1;
            }
            @if (Model?.ShowRangList is not null)
            {
                @foreach (var user in Model?.ShowRangList?.RangListUsers ?? new())
                {
                    <tr>
                        <td>@(i++)</td>
                        <td>@user?.User?.NameUser @user?.User?.Surname</td>
                        <td>@user?.User?.PlaceOfOrigin</td>
                        @foreach (var category in Model?.ShowRangList?.CategoriesRangList)
                        {
                            var userCategory = Model?.ShowRangList?.CategoryUsers?
                            .FirstOrDefault(cu => cu.UserId == user?.User?.Id && cu.CategoryId == category?.Category?.Id);
                            <td>@(userCategory?.Points ?? 0)</td>
                        }
                        @if ((Model?.SelectedEventId != null && Model?.SelectedCategoryId == null) ||
                       (Model?.SelectedCategoryId == null && Model?.SelectedYear != null) ||
                       (Model?.SelectedCategoryId == null && Model?.SelectedEventId != null && Model?.SelectedYear != null))
                        {
                            <td>@user?.Points</td>
                        }
                    </tr>
                }
            }
            else
            {
                <tr>
                    <td colspan="@(3 + (Model?.ShowRangList?.CategoriesRangList?.Count ?? 0) + 1)" class="text-danger">Нема ништо</td>
                </tr>
            }
        </tbody>
    </table>
</div>
